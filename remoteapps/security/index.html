<html><head><title>Security / Remote Apps</title><link rel="stylesheet" href="../_dmedia/bootstrap.css"/><link rel="stylesheet" href="../_dmedia/tango.css"/><link rel="stylesheet/less" type="text/css" href="../_dmedia/style.less"/><script src="../_dmedia/less.js" type="text/javascript">
        </script></head><body class="content">
        <div class="wrap">
            <header><h1><a href="..">Remote Apps</a></h1></header><div class="markdown"><h1><a href="">Security</a></h1>
<h2 id="request-authenticity">Request Authenticity</h2>
<p>The URLs published in an app descriptor file are accessed either directly by
Bitbucket, or by a user's browser. The former is the case for example when
asynchronous events related to a repository or user profile are delivered to
the remote app, while the latter is the case for custom tabs that contain
iframes with content from the remote app.</p>
<p>It is cucial for a remote app to be able to verify that the incoming request
was initiated by Bitbucket and ignore requests that are not.</p>
<p>This is important for example for the endpoint that receives repo events.
Without the ability to verify the authenticity of such incoming requests, anyone
could push events to the remote app.</p>
<p>It is also important for browser requests to iframes (UI tabs), because it
saves the remote app from having to use the Bitbucket REST API to actively
check whether the user has at least read access to the repository.</p>
<p>Bitbucket will never link to a remote repo tab for users without read access
to that repository and so any request that does come in proves to the remote
app that the user has sufficient privileges.</p>
<p>If this wasn't available, a remote app that is enabled on a private repository
would, for every incoming request, have to hit the Bitbucket REST API to check
the user's access level on that repository, significantly impacting performance.</p>
<h3 id="ssl-request-signing">SSL Request Signing</h3>
<p>Every request made to the remote app that was directly or indirectly initiated by
Bitbucket gets signed with a cryptographic signature. This is computed by taking
the SHA-1 hash of all the properties that make up the request and then encrypting
it with Bitbucket's SSL private key.</p>
<p>This approach is quite similar to how OAuth 1.0a (RFC-5849) computes signatures.</p>
<p>For the process to work, both server (Bitbucket) and client (remote app) need
to agree on how to create a canonical representation of all the request's
properties. For this, we follow section 3.4.1 (Signature Base String) up to, but
not including 3.4.2 (HMAC-SHA1).</p>
<p>To turn this Base String into an actual signature, we follow paragraph 3.4.3
(RSA-SHA1) of RFC-5849:</p>
<p>The "RSA-SHA1" signature method uses the RSASSA-PKCS1-v1_5 signature
algorithm as defined in <a href="http://tools.ietf.org/html/rfc3447">RFC-3447</a>,
section 8.2 (also known as PKCS#1), using SHA-1 as the hash function
for EMSA-PKCS1-v1_5.</p>
<p>The signature base string is signed using Bitbucket's RSA private
key per RFC-3447, section 8.2.1:</p>
<p>S = RSASSA-PKCS1-V1_5-SIGN (K, M)</p>
<p>Where:</p>
<p>K = Bitbucket's RSA private key
M = the value of the base string
S = the result signature</p>
<h2 id="app-descriptor-authenticity">App Descriptor Authenticity</h2>
<h2 id="app-trustworthiness">App Trustworthiness</h2>
                </div>
            <footer><div id="disqus_thread"/>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'remoteapps'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<p><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a></p>
<p>Fork this spec on <a href="https://bitbucket.org/evzijst/remoteapps">Bitbucket</a></p></footer></div>
    </body></html>